//
//  ABITests.swift
//  Caver-swiftTests
//
//  Created by won on 2021/05/20.
//

import XCTest
@testable import Caver_swift
@testable import SwiftyJSON
@testable import BigInt

class ABITests: XCTestCase {

    override func setUpWithError() throws {
        // Put setup code here. This method is called before the invocation of each test method in the class.
    }

    override func tearDownWithError() throws {
        // Put teardown code here. This method is called after the invocation of each test method in the class.
    }
    
    //MARK: encodeFunctionSig
    func testEncodeFunctionSignatureTest() throws {
        XCTAssertEqual("0xcdcd77c0", try ABI.encodeFunctionSignature("baz(uint32,bool)"))
        XCTAssertEqual("0xfce353f6", try ABI.encodeFunctionSignature("bar(bytes3[2])"))
        XCTAssertEqual("0xa5643bf2", try ABI.encodeFunctionSignature("sam(bytes,bool,uint256[])"))
    }
    
    //MARK: encodeEventSig
    func testEncodeEventSignature() throws {
        XCTAssertEqual("0x50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20", try ABI.encodeEventSignature("Deposit(address,hash256,uint256)"))
        XCTAssertEqual("0x71e71a8458267085d5ab16980fd5f114d2d37f232479c245d523ce8d23ca40ed", try ABI.encodeEventSignature("Notify(uint256,uint256)"))
    }
    
    //MARK: encodeFunctionCall
    func testEncodeFunctionCallTest() throws {
        XCTAssertEqual("0xcdcd77c000000000000000000000000000000000000000000000000000000000000000450000000000000000000000000000000000000000000000000000000000000001", try ABI.encodeFunctionCall("baz(uint32,bool)", ["uint32", "bool"], [69, true]))
        
        XCTAssertEqual("0xfce353f661626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeFunctionCall("bar(bytes3[2])", ["bytes3[2]"], [["abc".data(using: .utf8)!, "def".data(using: .utf8)!]]))
        
        XCTAssertEqual("0xa5643bf20000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000464617665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003", try ABI.encodeFunctionCall("sam(bytes,bool,uint256[])", ["bytes", "bool", "uint256[]"], ["dave".data(using: .utf8)!, true, [1, 2, 3]]))
    }
    
    //MARK: encodeParameter
    func testEncodeBoolType() throws {
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bool", false))
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000001", try ABI.encodeParameter("bool", true))
    }

    func testEncodeUintType() throws {
        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000ff", try ABI.encodeParameter("uint", BigInt(255)))
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000ffff", try ABI.encodeParameter("uint", BigInt(65535)))
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000010000", try ABI.encodeParameter("uint", BigInt(65536)))
        XCTAssertEqual("0000000000000000000000000000000000000000000000ffffffffffffffffff", try ABI.encodeParameter("uint", BigInt("4722366482869645213695")))
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("uint", BigInt.zero))
    }
    
    func testEncodeIntType() throws {
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("int", BigInt.zero))
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000007f", try ABI.encodeParameter("int", 127))
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000007fff", try ABI.encodeParameter("int", 32767))
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000007fffffff", try ABI.encodeParameter("int", 2147483647))
    }
    
    func testEncodeAddressType() throws {
        XCTAssertEqual("000000000000000000000000be5422d15f39373eb0a97ff8c10fbd0e40e29338", try ABI.encodeParameter("address", "0xbe5422d15f39373eb0a97ff8c10fbd0e40e29338"))
    }
    
    func testEncodeUtf8StringType() throws {
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020"
                        + "000000000000000000000000000000000000000000000000000000000000000d"
                        + "48656c6c6f2c20776f726c642100000000000000000000000000000000000000", try ABI.encodeParameter("string", "Hello, world!"))
    }
    
    func testEncodeStaticBytesType() throws {
        XCTAssertEqual("0001020304050000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes6", Data([0, 1, 2, 3, 4, 5])))
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes1", Data([0])))
        XCTAssertEqual("7f00000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes1", Data([127])))
        XCTAssertEqual("6461766500000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes4", "dave".data(using: .utf8)!))
    }
    
    func testEncodeDynamicBytesType() throws {
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020"
                        + "0000000000000000000000000000000000000000000000000000000000000006"
                        + "0001020304050000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes", Data([0, 1, 2, 3, 4, 5])))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020"
                        + "0000000000000000000000000000000000000000000000000000000000000001"
                        + "0000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes", Data([0])))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020"
                        + "0000000000000000000000000000000000000000000000000000000000000004"
                        + "6461766500000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes", "dave".data(using: .utf8)!))
        
        let loremIpsum = ("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod "
            + "tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim "
            + "veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex "
            + "ea commodo consequat. Duis aute irure dolor in reprehenderit in "
            + "voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur "
            + "sint occaecat cupidatat non proident, sunt in culpa qui officia "
            + "deserunt mollit anim id est laborum.").data(using: .utf8)!
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020"
                        + "00000000000000000000000000000000000000000000000000000000000001bd"
                        + "4c6f72656d20697073756d20646f6c6f722073697420616d65742c20636f6e73"
                        + "656374657475722061646970697363696e6720656c69742c2073656420646f20"
                        + "656975736d6f642074656d706f7220696e6369646964756e74207574206c6162"
                        + "6f726520657420646f6c6f7265206d61676e6120616c697175612e2055742065"
                        + "6e696d206164206d696e696d2076656e69616d2c2071756973206e6f73747275"
                        + "6420657865726369746174696f6e20756c6c616d636f206c61626f726973206e"
                        + "69736920757420616c697175697020657820656120636f6d6d6f646f20636f6e"
                        + "7365717561742e2044756973206175746520697275726520646f6c6f7220696e"
                        + "20726570726568656e646572697420696e20766f6c7570746174652076656c69"
                        + "7420657373652063696c6c756d20646f6c6f726520657520667567696174206e"
                        + "756c6c612070617269617475722e204578636570746575722073696e74206f63"
                        + "63616563617420637570696461746174206e6f6e2070726f6964656e742c2073"
                        + "756e7420696e2063756c706120717569206f666669636961206465736572756e"
                        + "74206d6f6c6c697420616e696d20696420657374206c61626f72756d2e000000", try ABI.encodeParameter("bytes", loremIpsum))
    }
    
    func testEncodeDynamicArrayTest() throws {
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020"
                        + "0000000000000000000000000000000000000000000000000000000000000003"
                        + "0000000000000000000000000000000000000000000000000000000000000001"
                        + "0000000000000000000000000000000000000000000000000000000000000002"
                        + "0000000000000000000000000000000000000000000000000000000000000003", try ABI.encodeParameter("uint256[]", [BigInt(1), BigInt(2), BigInt(3)]))
    }
    
    func testEncodeStaticArrayTest() throws {
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000000a"
                        + "0000000000000000000000000000000000000000000000007fffffffffffffff", try ABI.encodeParameter("uint256[2]", [BigInt(10), BigInt(Int.max)]))
    }
    
    func testEncodeArrayStaticType() throws {
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003", try ABI.encodeParameter("uint256[3]", [1, 2, 3]))

        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bool[2]", [true, false]))

        XCTAssertEqual("61626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes3[2]", ["abc".data(using: .utf8)!, "def".data(using: .utf8)!]))

        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003", try ABI.encodeParameter("uint256[]", [1, 2, 3]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bool[]", [true, false]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000261626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes3[]", ["abc".data(using: .utf8)!, "def".data(using: .utf8)!]))
        
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003", try ABI.encodeParameter("uint256[3][2]", [[1, 2, 3], [1, 2, 3]]))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bool[2][2]", [[true, false], [true, false]]))
        
        XCTAssertEqual("61626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes3[2][1]", [["abc".data(using: .utf8)!, "def".data(using: .utf8)!]]))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003", try ABI.encodeParameter("uint256[][2]", [[1, 2, 3], [1, 2, 3]]))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bool[][2]", [[true, false], [true, false]]))
        
        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000261626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes3[][1]", [["abc".data(using: .utf8)!, "def".data(using: .utf8)!]]))
        
        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003", try ABI.encodeParameter("uint256[3][]", [[1, 2, 3], [1, 2, 3]]))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bool[2][]", [[true, false]]))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000161626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes3[2][]", [["abc".data(using: .utf8)!, "def".data(using: .utf8)!]]))
        
        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003", try ABI.encodeParameter("uint256[][]", [[1, 2, 3], [1, 2, 3]]))
        
        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bool[][]", [[true, false], [true, false]]))
        
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000261626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes3[][]", [["abc".data(using: .utf8)!, "def".data(using: .utf8)!]]))
    }
    
    func testEncodeArrayDynamicType() throws {
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("string[2]", ["aaa", "bbb"]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes[2]", ["abc".data(using: .utf8)!, "def".data(using: .utf8)!]))

        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("string[]", ["aaa", "bbb"]))

        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes[]", ["abc".data(using: .utf8)!, "def".data(using: .utf8)!]))
        
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("string[2][2]", [["aaa", "bbb"], ["aaa", "bbb"]]))
        
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes[2][2]", [["abc".data(using: .utf8)!, "def".data(using: .utf8)!], ["abc".data(using: .utf8)!, "def".data(using: .utf8)!]]))

        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("string[][2]", [["aaa", "bbb"], ["aaa", "bbb"]]))

        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036162630000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000364656600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes[][2]", [["abc".data(using: .utf8)!, "def".data(using: .utf8)!], ["abc".data(using: .utf8)!, "def".data(using: .utf8)!]]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("string[2][]", [["aaa", "bbb"], ["aaa", "bbb"]]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes[2][]", [["abc".data(using: .utf8)!, "def".data(using: .utf8)!], ["abc".data(using: .utf8)!, "def".data(using: .utf8)!]]))

        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("string[][]", [["aaa", "bbb"], ["aaa", "bbb"]]))

        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036162630000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000364656600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("bytes[][]", [["abc".data(using: .utf8)!, "def".data(using: .utf8)!], ["abc".data(using: .utf8)!, "def".data(using: .utf8)!]]))
    }
    
    func testEncodeTupleType() throws {
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "0000000000000000000000000000000000000000000000000000000000000014" +
                        "77656c636f6d6520746f20657468657265756d2e000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000014" +
                        "77656c636f6d6520746f20657468657265756d2e000000000000000000000000", try ABI.encodeParameter("tuple(string,string)", ["welcome to ethereum.", "welcome to ethereum."]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "0000000000000000000000000000000000000000000000000000000000000014" +
                        "77656c636f6d6520746f20657468657265756d2e000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000014" +
                        "77656c636f6d6520746f20657468657265756d2e000000000000000000000000", try ABI.encodeParameter("tuple(bytes,bytes)", ["0x77656c636f6d6520746f20657468657265756d2e", "0x77656c636f6d6520746f20657468657265756d2e"]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "000000000000000000000000000000000000000000000000000000000001e663" +
                        "0000000000000000000000000000000000000000000000000000000000000014" +
                        "77656c636f6d6520746f20657468657265756d2e000000000000000000000000", try ABI.encodeParameter("tuple(bytes,bool,uint256)", ["0x77656c636f6d6520746f20657468657265756d2e", true, 124515]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff69" +
                        "0000000000000000000000000175010374017501037401750103740175010374" +
                        "0000000000000000000000000000000000000000000000000000000000000005" +
                        "68656c6c6f000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(string,tuple(bool,int256),address)", ["hello", [true, -151], "0x0175010374017501037401750103740175010374"]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                        "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                        "00000000000000000000000000000000000000000000000000000000000000a0" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "000000000000000000000000000000000000000000000000000000000000000a" +
                        "737472696e67204f6e6500000000000000000000000000000000000000000000" +
                        "000000000000000000000000000000000000000000000000000000000000000a" +
                        "737472696e672054776f00000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(tuple(bool,bool),tuple(address,address),tuple(string,string))", [[true, false], ["0x81017589ab81017589ab81017589ab81017589ab", "0x81017589ab81017589ab81017589ab81017589ab"], ["string One", "string Two"]]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "00000000000000000000000000000000000000000000000000000000000000a0" +
                        "000000000000000000000000ec2270c849236333c86834728e783cd2f789088e" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "000000000000000000000000000000000000000000000000000000000000000b" +
                        "0ab1394581edfa2ef9ca71000000000000000000000000000000000000000000" +
                        "000000000000000000000000000000000000000000000000000000000000000b" +
                        "15abe391df19aef19a4561000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(tuple(tuple(bool,bool),tuple(bytes,bytes),tuple(address,bool)),address)", [[[false, false],["0xab1394581edfa2ef9ca71", "0x15abe391df19aef19a4561"],["0xec2270c849236333c86834728e783cd2f789088e", true]], "0x81017589ab81017589ab81017589ab81017589ab"]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020" +
            "0000000000000000000000000000000000000000000000000000000000000001" +
            "00000000000000000000000000000000000000000000000000000000000000a0" +
            "0000000000000000000000000000000000000000000000000000000000000000" +
            "0000000000000000000000001981710abe1981710abe1981710abe1981710abe" +
            "0000000000000000000000001981710abe1981710abe1981710abe1981710abe" +
            "0000000000000000000000000000000000000000000000000000000000000007" +
            "74657374696e6700000000000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(bool,string,bool,tuple(address,address))", [true, "testing", false, ["0x1981710abe1981710abe1981710abe1981710abe", "0x1981710abe1981710abe1981710abe1981710abe"]]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020" +
                        "0000000000000000000000001981710abe1981710abe1981710abe1981710abe" +
                        "0000000000000000000000001981710abe1981710abe1981710abe1981710abe" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff861" +
                        "000000000000000000000000000000000000000000000000000000000002f5e2" +
                        "00000000000000000000000000000000000000000000000000000000000000c0" +
                        "0000000000000000000000000000000000000000000000000000000000000011" +
                        "7374727563747320617265206772656174000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000015" +
                        "736f206d616e7920706f73736962696c69746965730000000000000000000000", try ABI.encodeParameter("tuple(address,address,tuple(string,tuple(int256,int256),string))", ["0x1981710abe1981710abe1981710abe1981710abe", "0x1981710abe1981710abe1981710abe1981710abe", ["structs are great", [-1951, 194018], "so many possibilities"]]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18" +
                        "fffffffffffffffffffffffffffffffffffffffffffffffffffffffffee8e377" +
                        "abdef18710a18a18abdef18710a18a18abdef18710a18a180000000000000000" +
                        "abdef18710a18a18000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000120" +
                        "000000000000000000000000000000000000000000000000000000000000000f" +
                        "74657374696e672074657374696e670000000000000000000000000000000000", try ABI.encodeParameter("tuple(bool,tuple(bytes32,int256,tuple(bytes24,bytes8)),tuple(bool,bool,bool),string)", [true, ["0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18", -18291849, ["0xabdef18710a18a18abdef18710a18a18abdef18710a18a18", "0xabdef18710a18a18"]], [false, true, false], "testing testing"]))

        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000361616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003626262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036363630000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(string[3],bool)", [["aaa", "bbb", "ccc"], false]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000361616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003626262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036363630000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(bool,string[3],bool)", [true, ["aaa", "bbb", "ccc"], false]))

        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000361616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003626262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036363630000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(bool,string[],bool)", [true, ["aaa", "bbb", "ccc"], false]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000014d0000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(bool,uint256[3],bool)", [true, [111, 222, 333], false]))

        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000014d", try ABI.encodeParameter("tuple(bool,uint256[],bool)", [true, [111, 222, 333], false]))

        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000363636300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003646464000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036666660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(string[3],bool)[]", [[["aaa", "bbb", "ccc"], false], [["ccc", "ddd", "fff"], false]]))

        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000363636300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003646464000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036666660000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(string[3],bool)[2]", [[["aaa", "bbb", "ccc"], false], [["ccc", "ddd", "fff"], false]]))

        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000014d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000001bc000000000000000000000000000000000000000000000000000000000000022b000000000000000000000000000000000000000000000000000000000000029a0000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameter("tuple(bool,uint256[3],bool)[]", [[true, [111, 222, 333], false], [true, [444, 555, 666], false]]))
    }
    
    func testEncodeParametersWithTuple() throws {
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "0000000000000000000000000000000000000000000000000000000000000004" +
                        "7768617400000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "0000000000000000000000000000000000000000000000000000000000000009" +
                        "7768617420776861740000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000009" +
                        "7768617420776861740000000000000000000000000000000000000000000000", try ABI.encodeParameters(["string", "tuple(string,string)"], ["what", ["what what", "what what"]]))

        XCTAssertEqual("abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e", try ABI.encodeParameters(["tuple(bytes32,bool)", "tuple(bool,address)"], [["0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18", true], [true, "0x77656c636f6d6520746f20657468657265756d2e"]]))

        XCTAssertEqual("00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "0000000000000000000000000000000000000000000000000000000000000094" +
                        "0000000000000000000000000000000000000000000000000000000000001716" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18" +
                        "abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18", try ABI.encodeParameters(["tuple(address,uint256)", "tuple(uint256,bool)", "tuple(bytes32,bytes32)"], [["0x77656c636f6d6520746f20657468657265756d2e", 148], [5910, true], ["0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18", "0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18"]]))
        
        XCTAssertEqual("00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "00000000000000000000000000000000000000000000000000000000000000c0" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "00000000000000000000000000000000000000000000000000000000000000a0" +
                        "00000000000000000000000000000000000000000000000000000000000000b6" +
                        "0000000000000000000000000000000000000000000000000000000000000791" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "000000000000000000000000000000000000000000000000000000000000000b" +
                        "0ab1394581edfa2ef9ca71000000000000000000000000000000000000000000" +
                        "000000000000000000000000000000000000000000000000000000000000000b" +
                        "15abe391df19aef19a4561000000000000000000000000000000000000000000", try ABI.encodeParameters(["tuple(tuple(address,address),tuple(bool,bool))", "tuple(tuple(bool,bool),tuple(bytes,bytes),tuple(uint256,uint256))", "address"], [[["0x77656c636f6d6520746f20657468657265756d2e", "0x77656c636f6d6520746f20657468657265756d2e"], [true, false]], [[false, true], ["0xab1394581edfa2ef9ca71", "0x15abe391df19aef19a4561"], [182, 1937]], "0x77656c636f6d6520746f20657468657265756d2e"]))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000060" +
                        "00000000000000000000000000000000000000000000000000000000000001c0" +
                        "0000000000000000000000000000000000000000000000000000000000000200" +
                        "0000000000000000000000000000000000000000000000000000000000004790" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "00000000000000000000000000000000000000000000000000000000000002b3" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "000000000000000000000000000000000000000000000000000000000000000b" +
                        "0ab1394581edfa2ef9ca71000000000000000000000000000000000000000000" +
                        "000000000000000000000000000000000000000000000000000000000000000b" +
                        "15abe391df19aef19a4561000000000000000000000000000000000000000000" +
                        "000000000000000000000000000000000000000000000000000000000000000b" +
                        "0ab1394581edfa2ef9ca71000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "00000000000000000000000000000000000000000000000000000000000000e0" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "fe00000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000020" +
                        "abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18", try ABI.encodeParameters(["tuple(tuple(uint256,bool),tuple(uint256,tuple(bytes,bytes)))", "bytes", "tuple(bool,tuple(bytes,address),bytes)"], [[[18320, true], [691, ["0xab1394581edfa2ef9ca71", "0x15abe391df19aef19a4561"]]], "0xab1394581edfa2ef9ca71", [false, ["0xfe", "0x77656c636f6d6520746f20657468657265756d2e"], "0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18"]]))
        
        XCTAssertEqual("00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcf5d" +
                        "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff420336" +
                        "0000000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameters(["address", "tuple(bool,tuple(address,address))", "tuple(tuple(address,tuple(int256,int256)),bool)"], ["0x77656c636f6d6520746f20657468657265756d2e", [true, ["0x77656c636f6d6520746f20657468657265756d2e", "0x77656c636f6d6520746f20657468657265756d2e"]], [["0x77656c636f6d6520746f20657468657265756d2e", [-12451, -12451018]], false]]))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000060" +
                        "00000000000000000000000000000000000000000000000000000000000000a0" +
                        "0000000000000000000000000000000000000000000000000000000000000360" +
                        "0000000000000000000000000000000000000000000000000000000000000003" +
                        "abef150000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "0000000000000000000000000000000000000000000000000000000000000100" +
                        "0000000000000000000000000000000000000000000000000000000000000220" +
                        "00000000000000000000000000000000000000000000000000000000001c1435" +
                        "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffcf2c3ae9" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "00000000000000000000000000000000000000000000000000000000000000a0" +
                        "00000000000000000000000000000000000000000000000000000000000000e0" +
                        "0000000000000000000000000000000000000000000000000000000000000003" +
                        "abef150000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000004" +
                        "0cdef15100000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000004" +
                        "0abfe15100000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "000000000000000000000000000000000000000000000000000000000000000b" +
                        "15abe391df19aef19a4561000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "0000000000000000000000000000000000000000000000000000000000000014" +
                        "77656c636f6d6520746f20657468657265756d2e000000000000000000000000" +
                        "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffb7c5" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "00000000000000000000000000000000000000000000000000000000001d461b" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000006" +
                        "0abdcf151dae0000000000000000000000000000000000000000000000000000", try ABI.encodeParameters(["bytes", "tuple(tuple(bool,bool,bool),tuple(bytes,bytes,bytes),tuple(bytes,bool,address),tuple(uint256,int256,address))", "tuple(bytes,tuple(tuple(int256,bool),tuple(uint256,bytes)))"], ["0xabef15", [[true, false, true], ["0xabef15", "0xcdef151", "0xabfe151"], ["0x15abe391df19aef19a4561", true, "0x77656c636f6d6520746f20657468657265756d2e"], [1840181, -819184919, "0x77656c636f6d6520746f20657468657265756d2e"]], ["0x77656c636f6d6520746f20657468657265756d2e", [[-18491, false], [1918491, "0xabdcf151dae"]]]]))
        
        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000c0" +
                        "0000000000000000000000000000000000000000000000000000000000000160" +
                        "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                        "0000000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "0000000000000000000000000000000000000000000000000000000000000003" +
                        "abef150000000000000000000000000000000000000000000000000000000000" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "00000000000000000000000000000000000000000000000000000000000000a0" +
                        "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                        "0000000000000000000000000000000000000000000000000000000000000003" +
                        "abef150000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameters(["tuple(bytes,tuple(address,address))", "tuple(address,address,address,bytes,address)", "tuple(address,tuple(address,tuple(address,bool)))"], [["0xabef15", ["0x77656c636f6d6520746f20657468657265756d2e", "0x77656c636f6d6520746f20657468657265756d2e"]], ["0x77656c636f6d6520746f20657468657265756d2e", "0x77656c636f6d6520746f20657468657265756d2e", "0x77656c636f6d6520746f20657468657265756d2e", "0xabef15", "0x77656c636f6d6520746f20657468657265756d2e"], ["0x81017589ab81017589ab81017589ab81017589ab", ["0x77656c636f6d6520746f20657468657265756d2e", ["0x81017589ab81017589ab81017589ab81017589ab", false]]]]))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000060" +
                        "0000000000000000000000000000000000000000000000000000000000000120" +
                        "0000000000000000000000000000000000000000000000000000000000000160" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "0000000000000000000000000000000000000000000000000000000000000003" +
                        "abef150000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "0a00000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000020" +
                        "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "00000000000000000000000000000000000000000000000000000000000000c0" +
                        "0000000000000000000000000000000000000000000000000000000000000180" +
                        "0000000000000000000000000000000000000000000000000000000000000020" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "af00000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000040" +
                        "0000000000000000000000000000000000000000000000000000000000000080" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "af00000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "bc00000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000060" +
                        "00000000000000000000000000000000000000000000000000000000000000a0" +
                        "00000000000000000000000000000000000000000000000000000000000000e0" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "af00000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "bc00000000000000000000000000000000000000000000000000000000000000" +
                        "0000000000000000000000000000000000000000000000000000000000000001" +
                        "de00000000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameters(["tuple(bytes,bytes)", "bytes", "tuple(tuple(bytes),tuple(bytes,bytes),tuple(bytes,bytes,bytes))"], [["0xabef15", "0xa"], "0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff", [["0xaf"], ["0xaf", "0xbc"], ["0xaf", "0xbc", "0xde"]]]))
        
        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000056974656d310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000056974656d32000000000000000000000000000000000000000000000000000000", try ABI.encodeParameters(["tuple(string,uint)[]"], [[["item1", 2], ["item2", 3]]]))
        
        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000056974656d310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000056974656d32000000000000000000000000000000000000000000000000000000", try ABI.encodeParameters(["tuple(string,uint16)[]"], [[["item1", 2], ["item2", 3]]]))
    }
    
    func testEncodeParametersArrayType() throws {
        XCTAssertEqual("00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de", try ABI.encodeParameters(["bool[2]", "uint256[2]"], [[true, false], [111, 222]]))
        
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000361626300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003646566000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036464640000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameters(["bytes[][]", "string[][]"], [[["abc".data(using: .utf8)!, "def".data(using: .utf8)!], ["abc".data(using: .utf8)!, "def".data(using: .utf8)!]], [["aaa", "bbb"], ["ccc", "ddd"]]]))
        
        XCTAssertEqual("0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de00000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036464640000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameters(["bool[2]", "string[2]","uint256[2]", "string[]"], [[true, false], ["aaa", "bbb"], [111, 222], ["ccc", "ddd"]]))
        
        XCTAssertEqual("000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036464640000000000000000000000000000000000000000000000000000000000", try ABI.encodeParameters(["bool[]", "string[2]","uint256[]", "string[2]"], [[true, false], ["aaa", "bbb"], [111, 222], ["ccc", "ddd"]]))
    }
    
    func testBuildFunctionStringTest() throws {
        let caver = Caver("https://kaikas.cypress.klaytn.net:8651")
        if let file  = Bundle(for: type(of: self)).url(forResource: "testFunction", withExtension: "json"){
            let data  = try Data(contentsOf: file)
            let contract = try Contract(caver, String(data: data, encoding: .utf8)!)
     
            XCTAssertEqual("b(string)", try ABI.buildFunctionString(contract.getMethod("b")))
            XCTAssertEqual("g(uint256)", try ABI.buildFunctionString(contract.getMethod("g")))
            XCTAssertEqual("h(bytes32[])", try ABI.buildFunctionString(contract.getMethod("h")))
            
            XCTAssertEqual("staticStruct((uint256,uint256))", try ABI.buildFunctionString(contract.getMethod("staticStruct")))
            XCTAssertEqual("dynamicStruct((uint256,string))", try ABI.buildFunctionString(contract.getMethod("dynamicStruct")))
            XCTAssertEqual("structArray((uint256,uint256[],(uint256,uint256)[])[])", try ABI.buildFunctionString(contract.getMethod("structArray")))
        }else{
            print("no file")
        }
    }
}

